<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear</title>
</head>
<body>
    <div id="products-container" class="form-container">
        <h3>Alta productos</h3>

        <!-- Formulario para crear productos y enviarlos a /api/products -->
        <form id="altaProducts-container" class="form-alta">
    
            <label for="nameProd">Nombre</label>
            <input type="text" name="nombre" id="nameProd" required>
    
            <label for="imageProd">Imagen</label>
            <input type="text" name="img" id="imageProd" required>
    
            <label for="priceProd">Precio</label>
            <input type="number" name="precio" id="priceProd" required>
    
            <label for="categoryProd">Categoria</label>
            <select name="categoria" id="categoryProd" required>
                <option value="food">comida</option>
                <option value="drink">bebida</option>
            </select>
    
            <input type="submit" value="Crear producto">
        </form>
    </div>
    <script>

        let altaProducts_container = document.getElementById("altaProducts-container")
        let url = "http://localhost:3000"

        altaProducts_container.addEventListener("submit",async(event)=>{
            event.preventDefault(); //Evita el envio por defecto del formulario
            console.log(event.target);

            let formData = new FormData(event.target);
             console.log(formData);

            //Transformo la info del objeto FormData en objeto JS nomral
            let data = Object.fromEntries(formData.entries());

            try {
                let response = await fetch(`${url}/productos`,{
                    method: "POST",
                    headers: {
                        "Content-Type":"application/json",
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok){

                    console.log(response);
                    let result = await response.json();

                    console.log(result.message); //devuelve lo q tengamos en el message dentro de nuestro response en el endpoint
                    alert(result.message);
                };
            } catch (error) {
                console.error("Error al enviar los datos", error);
                alert("Error al procesar la solicitud")
            }
        })
    </script>
</body>
</html>